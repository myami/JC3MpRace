<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LobbyTest</title>


  <script type="text/javascript" src="../jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="../popper.js"></script>
  <script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script>
  <link href="../bootstrap/css/bootstrap.css" rel="stylesheet">
  <style type="text/css">
  </style>
</head>

<body>

  <script>
    var LobbyServerList = [];
    var PlayerLobbyData = [];
    var AllPlayerOnTheServer = [];

jcmp.AddEvent('PlayerJoinLobby',function(id,obj){ // Player joining the lobby
  let data = JSON.parse(obj);
  let NewLobby = {
    LobbyName: data.LobbyNameReceived,
    NumberofPlayer: data.PlayerListName.length,
    MapName: data.MapName,
    TypeRace:data.TypeRace,
    LobbyID: id,
    PlayerListName:data.PlayerListName
  }
  PlayerLobbyData.push(NewLobby);
  if (data.PlayerListName.length >= 1){
    for (let i = 0; i <   data.PlayerListName.length; i++) {
      let playername = data.PlayerListName[i];
      // Add all the player was before you on the UI lobby
    }
  }
  else{
    // show the data.PlayerListName[0]
    // Show the admin UI to can select the map and type and launch the race
  }

// Show the lobby UI with the map name etc...

});
jcmp.AddEvent('LobbyCreated',function(Obj){ // show the lobby on the server list
  let data = JSON.parse(Obj);
  let NewLobby = {
    LobbyName: data.LobbyNameReceived,
    NumberofPlayer: 1,
    MapName: "RaceIsland",
    TypeRace:"Classic",
    LobbyID: data.id,
    PlayerCreated: data.PlayerCreated,
    PlayerListName:data.PlayerListName
  }
  LobbyServerList.push(NewLobby);
//LobbyServerList is an array with all the lobby create on the server
});

jcmp.AddEvent('UpdateLengthLobby',function(id,newlength){
  for (let i = 0; i <   LobbyServerList.length; i++) {
    let lobby = LobbyServerList[i];
    if(lobby.LobbyID == id){
      lobby.NumberofPlayer = newlength;
      // show to everyone that are on the main menu the new lenght
    }
  }
});
jcmp.AddEvent('AddPlayerOnLobbyMenu',function(id,playername){ // Player already on the lobby
  for (let i = 0; i <   LobbyServerList.length; i++) {
    let lobby = LobbyServerList[i];
    if(lobby.LobbyID == id){
      lobby.PlayerListName.push(player.name);
      // show to everyone that are on the lobby the new guy
    }
  }
});
jcmp.AddEvent('PlayerRemoveLobby',function(id,playername){
  for (let i = 0; i <   LobbyServerList.length; i++) {
    let lobby = LobbyServerList[i];
    if(lobby.LobbyID == id){

      for (let i = 0; i <   PlayerListName.length; i++) {
        let player = PlayerListName[i];
        if (player == playername){
          delete player;
          //Remove player to everyone on the lobby

        }

      }

    }
  }
});



jcmp.AddEvent('ShowLobbyList',function(boolean){
  // show the LobbyServerList to the player or not
});
jcmp.AddEvent('PlayerReady_Lobby',function(id,playername){ // need to do it

});
jcmp.AddEvent('TypeOfRaceSelected',function(id,type){      // update the UI on server list

  for (let i = 0; i <   LobbyServerList.length; i++) {
    let lobby = LobbyServerList[i];
    if(lobby.LobbyID == id){
      lobby.TypeRace = type;
      // change on the LobbyServerList the type

    }
  }
});
jcmp.AddEvent('TypeOfRace',function(type){ // update for the player on the lobby menu
PlayerLobbyData.TypeRace = type;
});

jcmp.AddEvent('MapOfRaceSelected',function(id,map){      // update the UI on server list
  for (let i = 0; i <   LobbyServerList.length; i++) {
    let lobby = LobbyServerList[i];
    if(lobby.LobbyID == id){
      lobby.MapName = map;
      // change on the LobbyServerList the map
    }
  }
});
jcmp.AddEvent('MapOfRace',function(map){ // update for the player on the lobby menu
PlayerLobbyData.MapName = map;
});



function ChangeMapButton(){
jcmp.CallEvent('NewMapSelected',name);
}
function ChangeType(){
  jcmp.CallEvent('NewTypeSelected',type);
}
function ReadyButton(){
  jcmp.CallEvent('Ready_Player_Server_Test');
}

function PlayerleaveLobbyButton(){
  PlayerLobbyData = [];
  jcmp.CallEvent('Player_Remove_Lobby_Test');
}


jcmp.AddEvent('AddPlayerOnTheList',function(obj){ // for people already on the server to see the new guy
let data = JSON.parse(obj);
let newplayer = {
  PlayerName: data.PlayerName,
  PlayerNetworkid: data.PlayerNetworkid,
  IsinLobby: data.IsinLobby,
  LobbyID: data.LobbyID
}
AllPlayerOnTheServer.push(newplayer);
// Add the new player on the UI

});
jcmp.AddEvent('AddPlayerOnTheListJoin',function(obj){ // list of all player
let data = JSON.parse(obj);
data.forEach(function(p) {
  let newplayer = {
    PlayerName: p.PlayerName,
    PlayerNetworkid: p.PlayerNetworkid,
    IsinLobby: p.IsinLobby,
    LobbyID: p.LobbyID
  }
  AllPlayerOnTheServer.push(newplayer);

});

// when all the player are push show the list of player
});
jcmp.AddEvent('UpdatePlayerOnTheServer',function(networkid,isinlobby,idlobby){
  for (let i = 0; i < AllPlayerOnTheServer.length; i++) {
    let lobby = AllPlayerOnTheServer[i];
    if(player.PlayerNetworkid == networkid){
      player.IsinLobby = isinlobby;
      player.LobbyID = idlobby ;
      // update the ui
    }
  }
});

jcmp.AddEvent('RemovePlayer',function(networkid){
  for (let i = 0; i < AllPlayerOnTheServer.length; i++) {
    let lobby = AllPlayerOnTheServer[i];
    if(player.PlayerNetworkid == networkid){
      delete player;
    }
  }
})




  </script>
</body>

</html>
